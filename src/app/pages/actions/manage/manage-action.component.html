<div class="grid">
  <p-confirmPopup></p-confirmPopup>
  <div class="col-12">
    <div class="mx-2 py-2">
      <h4>
        <i class="bi bi-pencil"></i>
        Editar ações existentes
      </h4>
    </div>
    <div class="card">
      <p-table
        #table
        dataKey="id"
        [value]="actionService.actions"
        [loading]="actionService.loading"
        [lazy]="true"
        (onLazyLoad)="actionService.loadActions($event)"
        [paginator]="true"
        [rows]="10"
        [totalRecords]="actionService.totalRecords"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="{first} a {last} de {totalRecords} ação(ões)"
        editMode="row"
        stateStorage="session"
        stateKey="edit-actions"
        [tableStyle]="{ 'min-width': '50rem' }"
        [styleClass]="'p-datatable-sm'"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="nome">
              Nome <p-sortIcon field="nome"></p-sortIcon>
            </th>
            <th pSortableColumn="nomeItem">
              Vinculado ao item <p-sortIcon field="nomeItem"></p-sortIcon>
            </th>
            <th pSortableColumn="icone">
              Ícone <p-sortIcon field="icone"></p-sortIcon>
            </th>
            <th pSortableColumn="ativo">
              Ativo <p-sortIcon field="ativo"></p-sortIcon>
            </th>
            <th class="text-center" >Ações</th>
          </tr>
          <tr>
            <th>
              <p-columnFilter
                type="text"
                field="nome"
                matchMode="contains"
                [showMenu]="false"
                pTooltip="Quando estiver pronto, pressione 'Enter' para pesquisar!"
                tooltipPosition="top"
              >
              </p-columnFilter>
            </th>
            <th>
              <p-columnFilter
                type="text"
                field="items"
                matchMode="contains"
                [showMenu]="false"
                pTooltip="Quando estiver pronto, pressione 'Enter' para pesquisar!"
                tooltipPosition="top"
              >
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-multiSelect
                    inputId="filter_consultancy_type"
                    [options]="itemService.items"
                    [ngModel]="value"
                    optionLabel="nome"
                    optionValue="id"
                    (onChange)="filter($event.value)"
                    [style]="{ width: '100%' }"
                    appendTo="body"
                  >
                  </p-multiSelect>
                </ng-template>
              </p-columnFilter>
            </th>
            <th>
              <p-columnFilter
                type="text"
                field="icone"
                matchMode="contains"
                [showMenu]="false"
                pTooltip="Quando estiver pronto, pressione 'Enter' para pesquisar!"
                tooltipPosition="top"
              >
              </p-columnFilter>
            </th>
            <th>
              <p-columnFilter
                type="boolean"
                field="ativo"
                matchMode="equals"
                [showMenu]="false"
              >
              </p-columnFilter>
            </th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template
          pTemplate="body"
          let-action
          let-editing="editing"
          let-ri="rowIndex"
        >
          <tr [pEditableRow]="action">
            <td>
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="w-full"
                    pInputText
                    type="text"
                    [(ngModel)]="action.nome"
                    required
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ action.nome }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td>
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-dropdown
                    [style]="{ width: '100%' }"
                    [options]="itemService.items"
                    [filter]="true"
                    optionLabel="nome"
                    optionValue="id"
                    name="drop"
                    [(ngModel)]="action.idItem"
                    (onChange)="changeLabel(action)"
                  >
                  </p-dropdown>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ action.nomeItem }}
                </ng-template>
              </p-cellEditor>
            </td>
            <td>
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <input
                    class="w-full"
                    pInputText
                    type="text"
                    [(ngModel)]="action.icone"
                    required
                  />
                </ng-template>
                <ng-template pTemplate="output">
                  {{ action.icone }} | <i class="{{ action.icone }}"></i>
                </ng-template>
              </p-cellEditor>
            </td>
            <td>
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <p-checkbox
                    [(ngModel)]="action.ativo"
                    [binary]="true"
                    [value]="action.ativo == 1"
                  ></p-checkbox>
                </ng-template>
                <ng-template pTemplate="output">
                  <i
                    class="pi"
                    [ngClass]="
                      action.ativo == 1
                        ? 'text-green-500 pi-check-circle text-success'
                        : 'text-red-500 pi-times-circle text-danger'
                    "
                  ></i>
                </ng-template>
              </p-cellEditor>
            </td>
            <td>
              <div
                class="flex align-actions-center justify-content-center gap-2"
              >
                <button
                  *ngIf="!editing"
                  pButton
                  pRipple
                  type="button"
                  pInitEditableRow
                  icon="pi pi-pencil"
                  (click)="onRowEditInit(action)"
                  class="p-button-rounded p-button-text mr-2"
                ></button>
                <!-- <button
                  *ngIf="!editing"
                  pButton
                  pRipple
                  type="button"
                  icon="pi pi-trash"
                  (click)="deleteAction($event, action)"
                  class="p-button-rounded p-button-text p-button-danger"
                ></button> -->
                <button
                  *ngIf="editing"
                  pButton
                  pRipple
                  type="button"
                  pSaveEditableRow
                  icon="pi pi-check"
                  (click)="onRowEditSave(action)"
                  class="p-button-rounded p-button-text p-button-success mr-2"
                ></button>
                <button
                  *ngIf="editing"
                  pButton
                  pRipple
                  type="button"
                  pCancelEditableRow
                  icon="pi pi-times"
                  (click)="onRowEditCancel(action, ri)"
                  class="p-button-rounded p-button-text p-button-danger"
                ></button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
