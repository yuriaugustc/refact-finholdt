<div class="grid">
  <p-confirmPopup></p-confirmPopup>
	<div class="col-12">
		<div class="mx-2 py-2">
			<h4>
				<i class="bi bi-diagram-3"></i>
				Ação x Usuário
			</h4>
		</div>
		<div class="card">
			<p-table
				#table
				dataKey="id"
				[value]="actionService.userActions"
				[rows]="10"
				stateStorage="session"
				stateKey="link-actions"
				[(selection)]="selectedActions"
				[rowHover]="true"
				[tableStyle]="{ 'min-width': '50rem' }"
				[styleClass]="'p-datatable-sm'"
			>
				<ng-template pTemplate="caption">
					<div class="flex justify-content-between">
						<div>
							Item
							<i
								class="bi bi-info-circle mr-2"
								role="button"
								pTooltip="Selecione um usuário para carregar e gerenciar suas ações"
								tooltipPosition="top"
							></i>
							<p-dropdown
								[options]="userService.users"
								[filter]="true"
								name="drop"
								optionLabel="nome_completo"
								optionValue="id"
								[(ngModel)]="selectedUser"
								(onChange)="actionService.loadActionsByUserId(selectedUser)"
								[style]="{ 'min-width': '30em' }"
							>
							</p-dropdown>
						</div>
						<div>
							<p-button
								pTooltip="Adicionar acesso a uma ou mais ações"
								tooltipPosition="top"
								appendTo="body"
								icon="pi pi-plus"
								class="mx-1"
								[rounded]="true"
								[outlined]="true"
								severity="success"
								[style]="{ 'border-radius': '10px' }"
								(click)="openModal()"
								[disabled]="!selectedUser"
							>
							</p-button>
							<p-button
								pTooltip="Remover acesso da(s) ação(ões) selecionada(s)"
								tooltipPosition="top"
								appendTo="body"
								icon="pi pi-trash"
								(click)="removeSelectedActions($event)"
								class="mx-1"
								[rounded]="true"
								[outlined]="true"
								severity="danger"
								[style]="{ 'border-radius': '10px' }"
								[disabled]="!(selectedUser && selectedActions.length > 0)"
							>
							</p-button>
						</div>
					</div>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th style="width: 4rem">
							<p-tableHeaderCheckbox></p-tableHeaderCheckbox>
						</th>
						<th>Nome</th>
						<th>Vinculado ao item</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-action>
					<tr>
						<td>
							<p-tableCheckbox [value]="action"></p-tableCheckbox>
						</td>
						<td>{{ action.nome }}</td>
						<td>{{ action.item_pai }}</td>
					</tr>
				</ng-template>
			</p-table>
		</div>
		<p-dialog
			styleClass="p-fluid"
			[style]="{ width: '50rem' }"
			[(visible)]="showModal"
			[header]="'Adicionar uma ação para o usuário:'"
			[modal]="true"
			[draggable]="true"
			[closable]="false"
			[dismissableMask]="true"
		>
			<ng-template pTemplate="content">
				<div class="field">
					<label for="ativo">Selecione uma ou mais ações:</label>
					<p-multiSelect
						inputId="ativo"
						[options]="filtered_actions"
						appendTo="body"
						[filter]="true"
						optionLabel="nome"
						optionValue="id"
						[(ngModel)]="selectedActions"
						display="chip" 
						[showClear]="true"
					>
					</p-multiSelect>
				</div>
			</ng-template>
			<ng-template pTemplate="footer">
				<button
					pButton
					pRipple
					label="Cancelar"
					icon="pi pi-times"
					class="p-button-text"
					(click)="closeModal()"
				></button>
				<button
					pButton
					pRipple
					label="Salvar"
					icon="pi pi-check"
					class="p-button-text"
					(click)="onSave()"
				></button>
			</ng-template>
		</p-dialog>
	</div>
</div>
