<div class="grid">
	<div class="col-12">
		<div class="mx-2 py-2">
			<h4>
				<i class="bi bi-send-arrow-down"></i>
				Minhas Assessorias
			</h4>
		</div>
		<div class="card filter p-0">
			<p-accordion>
				<p-accordionTab	>
					<ng-template pTemplate="header">
						<span
							class="text-900 text-md">
							<i class="bi bi-funnel"></i>
							Filtros
						</span>
					</ng-template>
					<div pFocusTrap class="grid field m-0">
						<div class="field col-12 lg:col">
							<label for="filter_id">Id</label>
							<p-inputNumber
								[(ngModel)]="consultancyService.filters.id"
								pAutoFocus
								[autofocus]="true"
								inputId="filter_id"
								mode="decimal"
								[useGrouping]="false"
								class="w-full"
								[style]="{'width':'100%'}"
							></p-inputNumber>
						</div>
						<div class="field col-12 lg:col">
							<label for="filter_consultancy">
								Tipo de assessoria
							</label>
							<p-dropdown
								inputId="filter_consultancy"
								[options]="consultancyService.consultancyTypes"
								[(ngModel)]="consultancyService.filters.id_tipo_assessoria"
								optionLabel="nome"
								optionValue="id"
								[showClear]="true"
								[style]="{ width: '100%' }"
							></p-dropdown>
						</div>
						<div class="field col-12 lg:col">
							<label for="filter_client">
								{{ costumer ? 'Funcionario' : 'Cliente' }}
							</label>
							<p-dropdown
								*ngIf="!costumer"
								[options]="userService.costumers"
								[filter]="true"
								[(ngModel)]="consultancyService.filters.id_cliente"
								optionLabel="nome_completo"
								optionValue="id"
								inputId="filter_client"
								[showClear]="true"
								[style]="{'width':'100%'}"
							></p-dropdown>
							<!-- um pro cliente e um pro funcionario -->
							<p-dropdown
								*ngIf="costumer"
								[options]="userService.users"
								[filter]="true"
								[(ngModel)]="consultancyService.filters.id_cliente"
								optionLabel="nome_completo"
								optionValue="id"
								inputId="filter_client"
								[showClear]="true"
								[style]="{'width':'100%'}"
							></p-dropdown>
						</div>
						<div class="field col-12 lg:col">
							<label for="filter_status">Status</label>
							<p-dropdown
								[options]="consultancyService.consultancyStatus"
								[(ngModel)]="consultancyService.filters.id_status_assessoria"
								optionLabel="nome"
								optionValue="id"
								inputId="filter_status"
								[showClear]="true"
								[style]="{'width':'100%'}"
							></p-dropdown>
						</div>
						<div class="field col-12 lg:col">
							<label for="filter_data">Data</label>
							<p-calendar 
								[(ngModel)]="consultancyService.filters.data_contratacao" 
								[iconDisplay]="'input'"
								[showIcon]="true" 
								inputId="filter_data"
								view="month"
								dateFormat="mm/y"
								[readonlyInput]="true"
								[showButtonBar]="true"
								[style]="{'width':'100%'}"
							></p-calendar>
						</div>
						<div class="col-12 flex justify-content-end gap-2">
							<p-button
							label="Limpar"
							icon="pi pi-times"
							iconPos="right"
							[text]="true"
							[rounded]="true"
							(onClick)="clearFilter()"
							></p-button>
							<p-button
							label="Filtrar"
							icon="bi bi-funnel"
							iconPos="right"
							[rounded]="true"
							(onClick)="filter()"
							></p-button>
						</div>
					</div>
				</p-accordionTab>
			</p-accordion>
		</div>
		<div class="card">
			<p-dataView
				#dv
				[value]="consultancyService.consultancies"
				[rows]="10"
				[paginator]="true"
				[alwaysShowPaginator]="false"
				[lazy]="true"
				(onLazyLoad)="consultancyService.loadMyConsultancies($event)"
				[totalRecords]="consultancyService.totalRecords"
				[showCurrentPageReport]="true"
				currentPageReportTemplate="{first} a {last} de {totalRecords} assessoria(s)"
			>
				<ng-template pTemplate="list">
					<div class="grid grid-nogutter gap-1">
						<div
							class="col-12 dv-list border-1 surface-border border-round"
							*ngFor="let item of consultancyService.consultancies"
						>
							<div
								class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4"
								(click)="openModal(item.id)"
							>
								<div
									class="flex flex-column sm:flex-row justify-content-between align-items-stretch flex-1 gap-4"
								>
									<div
										class="flex flex-column align-items-center sm:align-items-start gap-3"
									>
										<div class="text-sm text-900 flex align-self-start">
											<span>
												<i class="bi bi-send"></i>
												{{ item.id }}
											</span>
										</div>
										<div class="text-xl text-900">
											<span class="mx-2">{{ item.tipo_assessoria?.nome }}</span>
										</div>
										<div class="flex align-items-center gap-3">
											<span class="flex align-content-end gap-2">
												<i class="pi pi-user"></i>
												<span>
													<span class="font-semibold mr-1">
														{{ costumer ? 'Funcionario' : 'Cliente' }}:
													</span>
													{{ costumer ? item.funcionario?.nome_completo : item.cliente?.nome_completo }}
												</span>
											</span>
										</div>
									</div>
									<div
										class="flex justify-content-between sm:justify-content-end sm:flex-column flex-row align-content-between gap-4"
									>
										<div class="text-900">
											<span class="font-semibold mr-1">Status:</span>
											{{ item.status_assessoria?.nome }}
										</div>
										<div class="flex align-self-center	 sm:align-self-end">
											<span class="font-semibold mr-1">Data:</span>
											{{ consultancyService.formatDate(item.data_contratacao) }}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</ng-template>
			</p-dataView>
			<app-consultancy-modal 
			[consultancy]="consultancyService.consultancy_view!"
			[(visible)]="visible"
			></app-consultancy-modal>
		</div>
	</div>
</div>
